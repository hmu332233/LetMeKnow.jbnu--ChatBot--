require 'util/TimeHelper'

class BusTracer
   
  def data(type, index)
     
    no1 = [
      ["10:30", "11:00", "11:30", "13:00", "13:30", "14:00"],
      ["10:33", "11:03", "11:33", "13:03", "13:33", "14:03"],
      ["10:35", "11:05", "11:35", "13:05", "13:35", "14:05"],
      ["10:37", "11:07", "11:37", "13:07", "13:37", "14:07"],
      ["10:39", "11:09", "11:39", "13:09", "13:39", "14:09"],
      ["10:41", "11:11", "11:41", "13:11", "13:41", "14:11"],
      ["10:43", "11:13", "11:43", "13:13", "13:43", "14:13"],
      ["10:45", "11:15", "11:45", "13:15", "13:45", "14:15"],
      ["10:50", "11:20", "11:50", "13:20", "13:50", "14:20"]
    ]
    
    no1_reverse = [
      ["10:30", "10:33", "10:35", "10:37", "10:39", "10:41", "10:43", "10:45", "10:50"],
      ["11:00", "11:03", "11:05", "11:07", "11:09", "11:11", "11:13", "11:15", "11:20"],
      ["11:30", "11:33", "11:35", "11:37", "11:39", "11:41", "11:43", "11:45", "11:50"],
      ["13:00", "13:03", "13:05", "13:07", "13:09", "13:11", "13:13", "13:15", "13:20"],
      ["13:30", "13:33", "13:35", "13:37", "13:39", "13:41", "13:43", "13:45", "13:50"],
      ["14:00", "14:03", "14:05", "14:07", "14:09", "14:11", "14:13", "14:15", "14:20"] 
    ]
    
    no2 = [
      ["10:30", "11:00", "11:30", "13:00", "13:30", "14:00"],
      ["10:33", "11:03", "11:33", "13:03", "13:33", "14:03"],
      ["10:35", "11:05", "11:35", "13:05", "13:35", "14:05"],
      ["10:37", "11:07", "11:37", "13:07", "13:37", "14:07"],
      ["10:39", "11:09", "11:39", "13:09", "13:39", "14:09"],
      ["10:41", "11:11", "11:41", "13:11", "13:41", "14:11"],
      ["10:45", "11:15", "11:45", "13:15", "13:45", "14:15"],
      ["10:53", "11:23", "11:53", "13:23", "13:53", "14:23"],
      ["10:55", "11:25", "11:55", "13:25", "13:55", "14:25"],
      ["11:00", "11:30", "12:00", "13:30", "14:00", "14:30"]
    ]
    
    no2_reverse = [
      ["10:30", "10:33", "10:35", "10:37", "10:39", "10:41", "10:45", "10:53", "10:55", "11:00" ],
      ["11:00", "11:03", "11:05", "11:07", "11:09", "11:11", "11:15", "11:23", "11:25", "11:30" ],
      ["11:30", "11:33", "11:35", "11:37", "11:39", "11:41", "11:45", "11:53", "11:55", "12:00" ],
      ["13:00", "13:03", "13:05", "13:07", "13:09", "13:11", "13:15", "13:23", "13:25", "13:30" ],
      ["13:30", "13:33", "13:35", "13:37", "13:39", "13:41", "13:45", "13:53", "13:55", "14:00" ],
      ["14:00", "14:03", "14:05", "14:07", "14:09", "14:11", "14:15", "14:23", "14:25", "14:30" ]
    ]
    
    if type == 'reverse'
      return [no1_reverse, no2_reverse][index]
    else
      return [no1, no2][index]
    end
  end
  
  def trace
    now = TimeHelper.new.now
    puts now
    print getNearestTime(0)
    return 'a'
  end
  
  def getNearestTime(no)
    bus_times = data('reverse', no)
    result = nil
    bus_times.each_with_index do |course_times, i|
      course_times.each_with_index do |course_time, j|
        unless isPast(course_time)
          return {
            time: course_time,
            index: [i, j]
          }
        end
      end
    end
  end
  
  def isPast(target_time)
    puts target_time
    now = TimeHelper.new.now
    
    splited_time1 = [now.hour, now.min]
    splited_time2 = target_time.split(':')
  
    return (DateTime.now.change({hour: splited_time1[0], min: splited_time1[1]}) - DateTime.now.change({hour: splited_time2[0].to_i, min: splited_time2[1].to_i})).positive?
  end
  
end